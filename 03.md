# 程序的机器级表示
### 程序的编码
`gcc -Og -o p p1.c p2.c`
- Og 告诉编译器优化等级
- -o p 指定生成的可执行文件名字叫做`p`

大致的执行的过程：
gcc命令是调用了一套的程序，将指定的代码转化为可执行的代码。
- 首先，C预处理器扩展源代码，将所用#include命令指定的文件插入，并拓展所使用#define声明指定的宏。
- 其次，编译器产生两个源文件的汇编代码，名字为p1.s和p2.s。
- 接下来，汇编器将汇编代码转换为二进制目标代码文件p1.o和p2.o。目标代码是机器代码的一种形式，其中包含所有指令的二进制表示，但是还没有填入全局值的地址。
- 最后，链接器将两个目标代码与实际库函数(例如printf)的代码合并，并产生最终的可执行代码文件p。

### C语言生成汇编代码

- 通过`-S`选项利用gcc生成汇编代码
`gcc -S file.c`

- 通过`-S`选项利用gcc生成汇编代码，同时进行优化`-Og`
`gcc -Og -S file.c`

将exchange.c转换为汇编。
```C
long exchange(long *xp, long y){

    long x = *xp;
    *xp = y;
    return x;
}
```
- `gcc -Og -S exchange.c`

生成的汇编代码如下：
```x86asm
exchange:
    movq    (%rdi), %rax
    movq    %rsi, (%rdi)
    ret
```

C语言代码中的xp和y分别存储在寄存器%rdi和%rsi中。然后从内存中读出x，把它存放在寄存器%rax中，直接实现了`long x = *xp;`,最后ret就是返回的这个值x，%rax。下一条指令将y的值写入到寄存器%rdi中，也就是xp所指向的那个内存位置，实现了`*xp = y;`。

### 
